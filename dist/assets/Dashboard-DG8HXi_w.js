import{g as k,r as n,c as j,d as c,e as F,j as e}from"./index-_3OQfKDT.js";import{u as T}from"./use_paginated_query-7fQe0RvS.js";import{T as b}from"./trending-up-DG9rkTgs.js";import{P as O}from"./printer-BAQL_cwa.js";import{X as L}from"./x-ChO8lI7J.js";const I=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],M=k("funnel",I);function z(){const[a,m]=n.useState(""),[r,h]=n.useState(""),[N,p]=n.useState(!1),[l,x]=n.useState("overview"),g=j(c.timeslots.list,{}),u=a||r?{timeslotId:r||void 0,startDate:a?(()=>{const t=new Date(a);return t.setHours(0,0,0,0),t.getTime()})():void 0,endDate:a?(()=>{const t=new Date(a);return t.setHours(23,59,59,999),t.getTime()})():void 0}:{},{results:d,status:y,loadMore:f}=T(c.orders.listOrders,u,{initialNumItems:20}),s=j(c.orders.getProfitStats,u),v=F(c.orders.updateStatus),w=n.useRef(null),C=()=>{window.print()},o=async(t,i)=>{await v({orderId:t,status:i})},S=()=>{m(""),h("")};return!d&&y==="LoadingFirstPage"?e.jsx("div",{children:"Loading Dashboard..."}):g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center no-print",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("div",{className:"space-x-4",children:[e.jsxs("button",{onClick:()=>p(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg flex items-center gap-2 hover:bg-purple-700",children:[e.jsx(b,{className:"w-4 h-4"})," Profits"]}),e.jsxs("button",{onClick:C,className:"px-4 py-2 bg-gray-800 text-white rounded-lg flex items-center gap-2 hover:bg-gray-900",children:[e.jsx(O,{className:"w-4 h-4"})," Print Orders"]})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 no-print",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"font-semibold text-gray-700",children:"Filter Orders:"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"date-filter",className:"text-sm text-gray-600",children:"Date:"}),e.jsx("input",{id:"date-filter",type:"date",value:a,onChange:t=>m(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"timeslot-filter",className:"text-sm text-gray-600",children:"Timeslot:"}),e.jsxs("select",{id:"timeslot-filter",value:r,onChange:t=>h(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"",children:"All Timeslots"}),g.map(t=>e.jsxs("option",{value:t._id,children:[t.label," (",t.startTime," - ",t.endTime,")"]},t._id))]})]}),e.jsx("button",{onClick:S,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Show All Orders"}),(a||r)&&e.jsxs("span",{className:"text-sm text-gray-500 ml-auto",children:["Showing ",d?d.length:0," orders"]})]})}),e.jsxs("div",{ref:w,className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden printable-area",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Today's Orders"}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString()})]}),e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Order No"}),e.jsx("th",{className:"px-6 py-3",children:"Customer"}),e.jsx("th",{className:"px-6 py-3",children:"Location"}),e.jsx("th",{className:"px-6 py-3",children:"Items"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Total"}),e.jsx("th",{className:"px-6 py-3",children:"Status"}),e.jsx("th",{className:"px-6 py-3 no-print",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:d?.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-mono font-medium",children:t.invoiceNumber}),e.jsx("td",{className:"px-6 py-4",children:t.userName}),e.jsx("td",{className:"px-6 py-4",children:t.locationName}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:t.items.map(i=>`${i.quantity}x ${i.name}`).join(", ")}),e.jsxs("td",{className:"px-6 py-4 text-right font-bold",children:["₹",t.totalAmount]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize
                    ${t.status==="delivered"?"bg-green-100 text-green-800":t.status==="confirmed"?"bg-blue-100 text-blue-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 no-print",children:e.jsxs("div",{className:"flex space-x-2",children:[t.status==="pending"&&e.jsx("button",{onClick:()=>o(t._id,"confirmed"),className:"text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600",children:"Confirm"}),t.status==="confirmed"&&e.jsx("button",{onClick:()=>o(t._id,"delivered"),className:"text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600",children:"Deliver"}),t.status!=="delivered"&&t.status!=="cancelled"&&e.jsx("button",{onClick:()=>o(t._id,"cancelled"),className:"text-xs bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"Cancel"})]})})]},t._id))})]}),y==="CanLoadMore"&&e.jsx("div",{className:"p-4 flex justify-center border-t border-gray-100 no-print",children:e.jsx("button",{onClick:()=>f(20),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition font-medium",children:"Load More"})})]}),N&&s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 no-print",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(b,{className:"w-6 h-6 text-purple-600"}),"Profit Statistics"]}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(L,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>x("overview"),className:`px-4 py-2 font-medium transition-colors ${l==="overview"?"text-purple-600 border-b-2 border-purple-600":"text-gray-500 hover:text-gray-700"}`,children:"Overview"}),e.jsx("button",{onClick:()=>x("daily"),className:`px-4 py-2 font-medium transition-colors ${l==="daily"?"text-purple-600 border-b-2 border-purple-600":"text-gray-500 hover:text-gray-700"}`,children:"Daily"}),e.jsx("button",{onClick:()=>x("monthly"),className:`px-4 py-2 font-medium transition-colors ${l==="monthly"?"text-purple-600 border-b-2 border-purple-600":"text-gray-500 hover:text-gray-700"}`,children:"Monthly"})]}),l==="overview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"Order Summary"}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:s.deliveredOrderCount}),e.jsx("span",{className:"text-gray-600",children:" delivered"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:s.cancelledOrderCount}),e.jsx("span",{className:"text-gray-600",children:" cancelled"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:s.totalOrderCount}),e.jsx("span",{className:"text-gray-600",children:" total"})]})]})]}),e.jsx("div",{className:"border-b border-gray-200 pb-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Total Income"}),e.jsxs("span",{className:"text-xl font-semibold text-green-600",children:["₹",s.totalIncome.toFixed(2)]})]})}),e.jsx("div",{className:"border-b border-gray-200 pb-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Purchase Costs"}),e.jsxs("span",{className:"text-xl font-semibold text-orange-600",children:["-₹",s.totalPurchaseCost.toFixed(2)]})]})}),e.jsx("div",{className:"border-b border-gray-200 pb-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Refunds (Cancelled)"}),e.jsxs("span",{className:"text-xl font-semibold text-red-600",children:["-₹",s.totalRefunds.toFixed(2)]})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg p-6 mt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Net Profit"}),e.jsxs("span",{className:`text-3xl font-bold ${s.netProfit>=0?"text-purple-600":"text-red-600"}`,children:["₹",s.netProfit.toFixed(2)]})]})}),(a||r)&&e.jsxs("div",{className:"text-xs text-gray-500 text-center mt-4",children:["Showing filtered results",a&&` for ${new Date(a).toLocaleDateString()}`,r&&" for selected timeslot"]})]}),l==="daily"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Daily Profit Breakdown"}),s.dailyBreakdown&&s.dailyBreakdown.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No daily data available"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Orders"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Total Income"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Costs"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Refunds"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Profit"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:s.dailyBreakdown?.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-right",children:t.orders}),e.jsxs("td",{className:"px-4 py-3 text-right text-green-600",children:["₹",t.income.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right text-orange-600",children:["-₹",t.purchaseCost.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right text-red-600",children:["-₹",t.refunds.toFixed(2)]}),e.jsxs("td",{className:`px-4 py-3 text-right font-bold ${t.profit>=0?"text-purple-600":"text-red-600"}`,children:["₹",t.profit.toFixed(2)]})]},t.date))})]})})]}),l==="monthly"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Monthly Profit Breakdown"}),s.monthlyBreakdown&&s.monthlyBreakdown.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No monthly data available"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Month"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Orders"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Total Income"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Costs"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Refunds"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Profit"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:s.monthlyBreakdown?.map(t=>{const[i,D]=t.month.split("-"),P=new Date(parseInt(i),parseInt(D)-1).toLocaleDateString("en-US",{month:"long",year:"numeric"});return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:P}),e.jsx("td",{className:"px-4 py-3 text-right",children:t.orders}),e.jsxs("td",{className:"px-4 py-3 text-right text-green-600",children:["₹",t.income.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right text-orange-600",children:["-₹",t.purchaseCost.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right text-red-600",children:["-₹",t.refunds.toFixed(2)]}),e.jsxs("td",{className:`px-4 py-3 text-right font-bold ${t.profit>=0?"text-purple-600":"text-red-600"}`,children:["₹",t.profit.toFixed(2)]})]},t.month)})})]})})]})]})}),e.jsx("style",{children:`
        @media print {
          body * {
            visibility: hidden;
          }
          .no-print {
            display: none !important;
          }
          .printable-area, .printable-area * {
            visibility: visible;
          }
          .printable-area {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
          }
        }
      `})]}):e.jsx("div",{children:"Loading Dashboard..."})}export{z as default};
