import{g as M,c as u,d as c,e as v,r as m,j as e}from"./index--VjYBowS.js";import{P as R}from"./plus-BB5vrTSW.js";import{P as _}from"./pen-CN8smYNn.js";import{X as O}from"./x-D_KyXBPT.js";import{I as P}from"./image-mf86drFn.js";const E=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],w=M("upload",E);function q({storageId:t,imageUrl:n,name:d}){const r=u(c.files.getImageUrl,t?{storageId:t}:"skip")||n;return r?e.jsx("img",{src:r,alt:d,className:"w-12 h-12 object-cover rounded-lg"}):e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(P,{className:"w-6 h-6 text-gray-400"})})}function D({storageId:t,imageUrl:n,onUploadClick:d}){const r=u(c.files.getImageUrl,t?{storageId:t}:"skip")||n;return r?e.jsxs("div",{className:"space-y-3",children:[e.jsx("img",{src:r,alt:"Preview",className:"w-full h-48 object-cover rounded-lg mx-auto"}),e.jsxs("button",{type:"button",onClick:d,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 inline-flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"})," Change Photo"]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx(P,{className:"w-12 h-12 text-gray-400 mx-auto"}),e.jsx("div",{children:e.jsxs("button",{type:"button",onClick:d,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 inline-flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"})," Upload Photo"]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG up to 10MB"})]})}function J(){const t=u(c.items.list),n=u(c.timeslots.list),d=v(c.items.create),h=v(c.items.update),r=v(c.files.generateUploadUrl),[U,g]=m.useState(!1),[p,f]=m.useState(null),[b,N]=m.useState(null),[S,x]=m.useState(""),y=m.useRef(null),[a,i]=m.useState({name:"",description:"",purchasePrice:0,sellingPrice:0,imageUrl:"",imageStorageId:"",availableTimeslotIds:[],isAvailable:!0}),I=s=>{s?(f(s),i({name:s.name,description:s.description||"",purchasePrice:s.purchasePrice,sellingPrice:s.sellingPrice,imageUrl:s.imageUrl||"",imageStorageId:s.imageStorageId,availableTimeslotIds:s.availableTimeslotIds,isAvailable:s.isAvailable}),s.imageStorageId||s.imageUrl?x(s.imageUrl||""):x("")):(f(null),i({name:"",description:"",purchasePrice:0,sellingPrice:0,imageUrl:"",imageStorageId:void 0,availableTimeslotIds:[],isAvailable:!0}),x("")),N(null),g(!0)},k=async s=>{s.preventDefault();try{let l=a.imageStorageId;if(b){const j=await r(),C=await fetch(j,{method:"POST",headers:{"Content-Type":b.type},body:b}),{storageId:F}=await C.json();l=F}const o={...a,imageStorageId:l,availableTimeslotIds:a.availableTimeslotIds};p?await h({id:p._id,...o}):await d(o),g(!1)}catch(l){console.error("Error saving item:",l),alert("Failed to save item")}},T=s=>{i(l=>{const o=l.availableTimeslotIds.includes(s)?l.availableTimeslotIds.filter(j=>j!==s):[...l.availableTimeslotIds,s];return{...l,availableTimeslotIds:o}})},A=s=>{const l=s.target.files?.[0];if(l){N(l);const o=URL.createObjectURL(l);x(o)}};return!t||!n?e.jsx("div",{children:"Loading Items..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Items Management"}),e.jsxs("button",{onClick:()=>I(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg flex items-center gap-2 hover:bg-blue-700",children:[e.jsx(R,{className:"w-4 h-4"})," Add New Item"]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Image"}),e.jsx("th",{className:"px-6 py-3",children:"Item Name"}),e.jsx("th",{className:"px-6 py-3",children:"Purchase Rate"}),e.jsx("th",{className:"px-6 py-3",children:"Selling Rate"}),e.jsx("th",{className:"px-6 py-3",children:"Available Timeslots"}),e.jsx("th",{className:"px-6 py-3",children:"Status"}),e.jsx("th",{className:"px-6 py-3",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:t.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx(q,{storageId:s.imageStorageId,imageUrl:s.imageUrl,name:s.name})}),e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",children:s.name}),e.jsxs("td",{className:"px-6 py-4",children:["₹",s.purchasePrice]}),e.jsxs("td",{className:"px-6 py-4 font-bold text-green-600",children:["₹",s.sellingPrice]}),e.jsxs("td",{className:"px-6 py-4 text-xs text-gray-500 max-w-xs truncate",children:[s.availableTimeslotIds.length," slots"]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${s.isAvailable?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.isAvailable?"Available":"Unavailable"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>I(s),className:"text-blue-600 hover:bg-blue-50 p-2 rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})})]},s._id))})]})}),U&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-lg overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:p?"Edit Item":"New Item"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(O,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:k,className:"p-6 space-y-4 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),e.jsx("input",{required:!0,type:"text",className:"w-full border rounded p-2",value:a.name,onChange:s=>i({...a,name:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Purchase Price"}),e.jsx("input",{required:!0,type:"number",className:"w-full border rounded p-2",value:a.purchasePrice,onChange:s=>i({...a,purchasePrice:Number(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Selling Price"}),e.jsx("input",{required:!0,type:"number",className:"w-full border rounded p-2",value:a.sellingPrice,onChange:s=>i({...a,sellingPrice:Number(s.target.value)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{className:"w-full border rounded p-2",value:a.description,onChange:s=>i({...a,description:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Food Item Photo"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center",children:[e.jsx(D,{storageId:a.imageStorageId,imageUrl:S,onUploadClick:()=>y.current?.click()}),e.jsx("input",{ref:y,type:"file",accept:"image/*",onChange:A,className:"hidden"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Available In Timeslots"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:n.map(s=>e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:a.availableTimeslotIds.includes(s._id),onChange:()=>T(s._id)}),e.jsx("span",{children:s.label})]},s._id))})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:a.isAvailable,onChange:s=>i({...a,isAvailable:s.target.checked})}),e.jsx("label",{className:"text-sm font-medium",children:"Available for Order"})]}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold",children:"Save Item"})})]})]})})]})}export{J as default};
