import{b as D,u as F,a as R,c as U,d as p,e as j,r as i,j as e,L as q}from"./index--VjYBowS.js";function L(){const{signIn:x,signOut:w}=D(),g=F(),{isAuthenticated:n,isLoading:N}=R(),s=U(p.verification.getCurrentUser),h=j(p.users.assignDefaultRole),v=j(p.users.updateWhatsAppNumber),[f,A]=i.useState(!1),[o,r]=i.useState(null),[d,b]=i.useState(!1),[c,y]=i.useState(!1),[u,S]=i.useState("");if(i.useEffect(()=>{(async()=>{if(n&&s&&!s.role&&!f&&!d){console.log("Assigning role to authenticated user..."),b(!0);try{await h(),console.log("Role assigned successfully"),A(!0)}catch(l){console.error("Failed to assign role:",l),r("Failed to set up your account. Please try again."),b(!1)}}})()},[n,s,f,h,d]),i.useEffect(()=>{n&&s&&s.role&&!s.phone&&!c&&y(!0)},[n,s,c]),N)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsx("div",{className:"text-xl font-semibold text-gray-600",children:"Loading..."})});if(n&&s===void 0)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsx("div",{className:"text-xl font-semibold text-gray-600",children:"Loading your account..."})});if(n&&s&&!s.role&&d)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsx("div",{className:"text-xl font-semibold text-gray-600",children:"Setting up your account..."})});if(n&&s&&s.role)return e.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100",children:e.jsxs("div",{className:"p-8 bg-white rounded-lg shadow-md max-w-md text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 p-2 text-[#1B4332] font-serif",style:{fontFamily:"'Playfair Display', serif"},children:"You are already logged in"}),e.jsxs("p",{className:"mb-6 text-gray-600",children:["You are currently signed in as ",e.jsx("span",{className:"font-semibold",children:s.name||"User"})," (",s.email,")."]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>g(s.role==="admin"?"/admin/dashboard":"/home"),className:"w-full py-2 font-semibold text-white transition-colors bg-[#1B4332] rounded-md hover:bg-[#2E7D32]",children:["Continue as ",s.name?s.name.split(" ")[0]:"User"]}),e.jsx("button",{onClick:async()=>{await w()},className:"w-full py-2 font-semibold text-[#1B4332] transition-colors border-2 border-[#1B4332] rounded-md hover:bg-gray-50",children:"Log Out & Create New Account"})]})]})});const P=a=>{a.preventDefault(),r(null);const l=new FormData(a.currentTarget),W=l.get("password"),E=l.get("confirmPassword");if(W!==E){r("Passwords do not match");return}x("password",l).catch(m=>{console.error("Sign up error:",m);let t=m instanceof Error?m.message:"Could not create account";t.includes("Account")&&t.includes("already exists")?t="Account with this email already exists. Please sign in instead.":(t=t.replace(/^(Server Error\s*)+/i,""),t=t.replace(/^(Uncaught Error:\s*)+/i,""),t=t.trim()),r(t)})},C=async a=>{if(a.preventDefault(),r(null),!u.trim()){r("WhatsApp number is required");return}try{await v({phone:u}),y(!1),g(s?.role==="admin"?"/admin/dashboard":"/home")}catch(l){console.error("Failed to update WhatsApp number:",l),r("Failed to save WhatsApp number. Please try again.")}};return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100",children:[c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-[#1B4332] font-serif",style:{fontFamily:"'Playfair Display', serif"},children:"Complete Your Profile"}),e.jsx("p",{className:"mb-4 text-gray-600",children:"Please provide your WhatsApp number to complete registration."}),o&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 text-sm rounded",children:o}),e.jsxs("form",{onSubmit:C,className:"flex flex-col gap-4",children:[e.jsx("input",{type:"tel",value:u,onChange:a=>S(a.target.value),placeholder:"WhatsApp Number (e.g., +919876543210)",className:"w-full px-4 py-2 border rounded-md",required:!0}),e.jsx("button",{type:"submit",className:"w-full py-2 font-semibold text-white transition-colors bg-[#1B4332] rounded-md hover:bg-[#2E7D32]",children:"Continue"})]})]})}),e.jsxs("div",{className:"p-8 bg-white rounded-lg shadow-md w-96",children:[e.jsx("h1",{className:"mb-6 text-2xl font-bold text-center text-[#1B4332] font-serif",style:{fontFamily:"'Playfair Display', serif"},children:"ASKA Sign Up"}),o&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 text-sm rounded",children:o}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:P,className:"flex flex-col gap-2",children:[e.jsx("input",{name:"name",placeholder:"Full Name",className:"w-full px-4 py-2 border rounded-md",required:!0}),e.jsx("input",{name:"phone",placeholder:"WhatsApp Number (e.g., +919876543210)",className:"w-full px-4 py-2 border rounded-md",required:!0}),e.jsx("input",{name:"email",placeholder:"Email",className:"w-full px-4 py-2 border rounded-md",required:!0}),e.jsx("input",{name:"password",type:"password",placeholder:"Password",className:"w-full px-4 py-2 border rounded-md",required:!0}),e.jsx("input",{name:"confirmPassword",type:"password",placeholder:"Confirm Password",className:"w-full px-4 py-2 border rounded-md",required:!0}),e.jsx("input",{name:"flow",type:"hidden",value:"signUp"}),e.jsx("button",{type:"submit",className:"w-full py-2 font-semibold text-white transition-colors bg-green-600 rounded-md hover:bg-green-700",children:"Sign Up"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(q,{to:"/",className:"text-sm text-gray-600 hover:text-gray-900",children:"Already have an account? Sign in"})}),e.jsxs("div",{className:"relative flex items-center justify-center my-4",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("span",{className:"relative z-10 px-2 bg-white text-sm text-gray-500",children:"OR"})]}),e.jsx("button",{onClick:()=>{r(null),x("google").catch(a=>{console.error("Google sign-up error:",a),r("Failed to sign up with Google. Please try again.")})},className:"w-full py-2 font-semibold text-white transition-colors bg-blue-600 rounded-md hover:bg-blue-700 flex items-center justify-center gap-2",children:"Sign up with Google"})]})]})]})}export{L as default};
