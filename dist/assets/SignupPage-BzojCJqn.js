import{b as v,u as A,a as S,c as P,d as f,e as R,r as l,j as e,L as C}from"./index-_3OQfKDT.js";function U(){const{signIn:d,signOut:h}=v(),p=A(),{isAuthenticated:a,isLoading:y}=S(),s=P(f.verification.getCurrentUser),u=R(f.users.assignDefaultRole),[m,b]=l.useState(!1),[g,r]=l.useState(null),[o,x]=l.useState(!1);if(l.useEffect(()=>{(async()=>{if(a&&s&&!s.role&&!m&&!o){console.log("Assigning role to authenticated user..."),x(!0);try{await u(),console.log("Role assigned successfully"),b(!0)}catch(i){console.error("Failed to assign role:",i),r("Failed to set up your account. Please try again."),x(!1)}}})()},[a,s,m,u,o]),y)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsx("div",{className:"text-xl font-semibold text-gray-600",children:"Loading..."})});if(a&&s===void 0)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsx("div",{className:"text-xl font-semibold text-gray-600",children:"Loading your account..."})});if(a&&s&&!s.role&&o)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsx("div",{className:"text-xl font-semibold text-gray-600",children:"Setting up your account..."})});if(a&&s&&s.role)return e.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100",children:e.jsxs("div",{className:"p-8 bg-white rounded-lg shadow-md max-w-md text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 p-2 text-[#1B4332] font-serif",style:{fontFamily:"'Playfair Display', serif"},children:"You are already logged in"}),e.jsxs("p",{className:"mb-6 text-gray-600",children:["You are currently signed in as ",e.jsx("span",{className:"font-semibold",children:s.name||"User"})," (",s.email,")."]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>p(s.role==="admin"?"/admin/dashboard":"/home"),className:"w-full py-2 font-semibold text-white transition-colors bg-[#1B4332] rounded-md hover:bg-[#2E7D32]",children:["Continue as ",s.name?s.name.split(" ")[0]:"User"]}),e.jsx("button",{onClick:async()=>{await h()},className:"w-full py-2 font-semibold text-[#1B4332] transition-colors border-2 border-[#1B4332] rounded-md hover:bg-gray-50",children:"Log Out & Create New Account"})]})]})});const j=n=>{n.preventDefault(),r(null);const i=new FormData(n.currentTarget),w=i.get("password"),N=i.get("confirmPassword");if(w!==N){r("Passwords do not match");return}d("password",i).catch(c=>{console.error("Sign up error:",c);let t=c instanceof Error?c.message:"Could not create account";t.includes("Account")&&t.includes("already exists")?t="Account with this email already exists. Please sign in instead.":(t=t.replace(/^(Server Error\s*)+/i,""),t=t.replace(/^(Uncaught Error:\s*)+/i,""),t=t.trim()),r(t)})};return e.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100",children:e.jsxs("div",{className:"p-8 bg-white rounded-lg shadow-md w-96",children:[e.jsx("h1",{className:"mb-6 text-2xl font-bold text-center text-[#1B4332] font-serif",style:{fontFamily:"'Playfair Display', serif"},children:"ASKA Sign Up"}),g&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 text-sm rounded",children:g}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:j,className:"flex flex-col gap-2",children:[e.jsx("input",{name:"name",placeholder:"Full Name",className:"w-full px-4 py-2 border rounded-md",required:!0}),e.jsx("input",{name:"email",placeholder:"Email",className:"w-full px-4 py-2 border rounded-md",required:!0}),e.jsx("input",{name:"password",type:"password",placeholder:"Password",className:"w-full px-4 py-2 border rounded-md",required:!0}),e.jsx("input",{name:"confirmPassword",type:"password",placeholder:"Confirm Password",className:"w-full px-4 py-2 border rounded-md",required:!0}),e.jsx("input",{name:"flow",type:"hidden",value:"signUp"}),e.jsx("button",{type:"submit",className:"w-full py-2 font-semibold text-white transition-colors bg-green-600 rounded-md hover:bg-green-700",children:"Sign Up"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(C,{to:"/",className:"text-sm text-gray-600 hover:text-gray-900",children:"Already have an account? Sign in"})}),e.jsxs("div",{className:"relative flex items-center justify-center my-4",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("span",{className:"relative z-10 px-2 bg-white text-sm text-gray-500",children:"OR"})]}),e.jsx("button",{onClick:()=>{r(null),d("google").catch(n=>{console.error("Google sign-up error:",n),r("Failed to sign up with Google. Please try again.")})},className:"w-full py-2 font-semibold text-white transition-colors bg-blue-600 rounded-md hover:bg-blue-700 flex items-center justify-center gap-2",children:"Sign up with Google"})]})]})})}export{U as default};
